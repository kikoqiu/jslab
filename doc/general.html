<h2>General Functions</h2>
<p>These functions are provided by JSLab for convenience. Many are available directly in the global namespace (e.g., <code>rangen</code>, <code>range</code>, <code>echo</code>, <code>plot</code>, <code>latex</code>), while all are accessible via the <code>box</code> object (e.g., <code>box.rangen</code>).</p>

<h3><code>rangen(a, b, step=1, mapper)</code></h3>
<p>Range generator.</p>
<ul>
    <li><code>a</code>: start value.</li>
    <li><code>b</code>: end value.</li>
    <li><code>step</code>: (Optional) step value. Defaults to 1. If a function is provided, it's treated as the mapper.</li>
    <li><code>mapper</code>: (Optional) A function to map each generated value (e.g., <code>i => Math.sin(i)</code>).</li>
</ul>
<pre><code>// Generate numbers from 0 to 9
let gen1 = rangen(0, 10);
for (let val of gen1) {
    console.log(val);
}

// Generate numbers from 0 to 9 with step 2
let gen2 = rangen(0, 10, 2);
for (let val of gen2) {
    console.log(val);
}

// Generate sines of numbers from 0 to 9
let gen3 = rangen(0, 10, i => Math.sin(i));
for (let val of gen3) {
    console.log(val);
}</code></pre>

<h3><code>range(a, b, step=1, mapper)</code></h3>
<p>Returns an array generated by the <code>rangen</code> function.</p>
<ul>
    <li><code>a</code>: start value.</li>
    <li><code>b</code>: end value.</li>
    <li><code>step</code>: (Optional) step value. Defaults to 1. If a function is provided, it's treated as the mapper.</li>
    <li><code>mapper</code>: (Optional) A function to map each generated value (e.g., <code>i => Math.sin(i)</code>).</li>
</ul>
<pre><code>// Create an array of numbers from 0 to 9
let arr1 = range(0, 10); // [0, 1, 2, ..., 9]

// Create an array of even numbers from 0 to 9
let arr2 = range(0, 10, 2); // [0, 2, 4, 6, 8]

// Create an array of squares
let arr3 = range(0, 5, i => i * i); // [0, 1, 4, 9, 16]</code></pre>

<h3><code>echo(...o)</code></h3>
<p>Prints output to the current cell's output area, formatted with HTML line breaks.</p>
<ul>
    <li><code>...o</code>: One or more values to output.</li>
</ul>
<pre><code>echo('Hello, JSLab!');
echo('The answer is', 42);
let myVar = 'test';
echo(`Value: ${myVar}`);</code></pre>

<h3><code>plotly(data, layout, config, style)</code></h3>
<p>Plots data using the Plotly.js library.</p>
<ul>
    <li><code>data</code>: An array of trace objects compatible with Plotly.js.</li>
    <li><code>layout</code>: (Optional) An object defining the plot's layout.</li>
    <li><code>config</code>: (Optional) An object defining the plot's configuration.</li>
    <li><code>style</code>: (Optional) Extra CSS style for the plot <code>div</code> (e.g., <code>'height:400px; width:100%;'</code>).</li>
</ul>
<pre><code>// Example: Simple scatter plot
const x = range(0, 10, 0.5);
const y = x.map(val => val * val);
plotly([{ x: x, y: y, mode: 'markers', type: 'scatter' }], { title: 'Parabola' });</code></pre>

<h3><code>unpack(data, ...props)</code></h3>
<p>Unpacks an array of objects to get arrays of properties. Useful for preparing data for plotting.</p>
<ul>
    <li><code>data</code>: An array of objects.</li>
    <li><code>...props</code>: One or more property names (strings) to extract.</li>
</ul>
<pre><code>const data = [{ a: 1, b: 10 }, { a: 2, b: 20 }, { a: 3, b: 30 }];
const [a_vals, b_vals] = unpack(data, 'a', 'b');
// a_vals will be [1, 2, 3]
// b_vals will be [10, 20, 30]

const b_only = unpack(data, 'b');
// b_only will be [[10, 20, 30]] (if only one prop is given it's an array of arrays)</code></pre>

<h3><code>plot(...args)</code></h3>
<p>Plots 2D line figures. A simplified interface to <code>plotly</code>.</p>
<p>Can accept arguments in several forms:</p>
<ul>
    <li><code>y_array</code>: Plots <code>y_array</code> against <code>x = [0, 1, 2, ...]</code>.</li>
    <li><code>x1_array, y1_array, x2_array, y2_array, ..., options_object</code>: Plots multiple traces.</li>
    <li><code>options_object</code> can contain <code>labels</code> (or <code>names</code>), <code>style</code>, <code>layout</code>, and <code>config</code>.</li>
</ul>
<pre><code>// Plot a single line
plot(range(0, 10, i => i * i));

// Plot two lines
const x = range(0, 10);
const y1 = x.map(val => val);
const y2 = x.map(val => val * 2);
plot(x, y1, x, y2, { labels: ['Line 1', 'Line 2'], layout: { title: 'Two Lines' } });</code></pre>

<h3><code>plot3d(...args)</code></h3>
<p>Plots 3D line figures. A simplified interface to <code>plotly</code> for 3D scatter plots.</p>
<p>Can accept arguments in several forms:</p>
<ul>
    <li><code>x1_array, y1_array, z1_array, x2_array, y2_array, z2_array, ..., options_object</code>: Plots multiple 3D traces.</li>
    <li><code>options_object</code> can contain <code>labels</code> (or <code>names</code>), <code>style</code>, <code>layout</code>, and <code>config</code>.</li>
</ul>
<pre><code>// Plot a simple helix
const t = range(0, 6.28, 0.1);
const x = t.map(val => Math.cos(val));
const y = t.map(val => Math.sin(val));
const z = t;
plot3d(x, y, z, { layout: { title: 'Helix' } });</code></pre>

<h3><code>readfile(type='text', encoding="utf-8")</code></h3>
<p>Opens a file dialog for the user to select a file and reads its content. Returns a Promise.</p>
<ul>
    <li><code>type</code>: (Optional) The type of content to read. Can be <code>'text'</code>, <code>'bin'</code> (ArrayBuffer), <code>'binstr'</code> (binary string), or <code>'dataurl'</code>. Defaults to <code>'text'</code>.</li>
    <li><code>encoding</code>: (Optional) Encoding for reading text files. Defaults to <code>"utf-8"</code>.</li>
</ul>
<p>Returns a Promise that resolves with an array: <code>[content, filename, size]</code>.</p>
<pre><code>// Read a text file
readfile('text').then(([content, name, size]) => {
    echo(`File: ${name}, Size: ${size}\nContent:\n${content.substring(0, 200)}...`);
}).catch(err => echo('Error reading file:', err));

// Read an image as a data URL
readfile('dataurl').then(([dataUrl, name, size]) => {
    echo(`&lt;img src="${dataUrl}" style="max-width:200px;"&gt;`);
});</code></pre>

<h3><code>compile_expr(e)</code> (alias: <code>expr(e)</code>)</h3>
<p>Compiles a math.js expression. Useful for evaluating expressions multiple times with different scopes.</p>
<ul>
    <li><code>e</code>: The math.js expression string.</li>
</ul>
<p>Returns a compiled node with an <code>eval(scope)</code> function.</p>
<pre><code>const compiled = compile_expr('x + y');
const result1 = compiled.eval({ x: 5, y: 3 }); // 8
const result2 = compiled.eval({ x: 10, y: 2 }); // 12</code></pre>

<h3><code>eval_expr(e, scope)</code></h3>
<p>Evaluates a math.js expression directly.</p>
<ul>
    <li><code>e</code>: The math.js expression string.</li>
    <li><code>scope</code>: (Optional) An object defining variables in the expression's scope.</li>
</ul>
<pre><code>const result = eval_expr('2 * pi + e', { pi: Math.PI, e: Math.E });
echo(result); // Approximately 9.05...
</code></pre>

<h3><code>deriv(expr, variable)</code></h3>
<p>Calculates the symbolic derivative of a math.js expression.</p>
<ul>
    <li><code>expr</code>: The expression as a string or math.js node.</li>
    <li><code>variable</code>: The variable with respect to which to differentiate (string).</li>
</ul>
<pre><code>const derivative = deriv('x^2 + 2*x', 'x');
echo(derivative.toString()); // "2 * x + 2"</code></pre>

<h3><code>symplify(expr)</code></h3>
<p>Simplifies a math.js expression.</p>
<ul>
    <li><code>expr</code>: The expression as a string or math.js node.</li>
</ul>
<pre><code>const simplified = symplify('2*x + x + 3');
echo(simplified.toString()); // "3 * x + 3"</code></pre>

<h3><code>latexstr(...ex)</code></h3>
<p>Converts one or more math.js expressions (or strings) into a single LaTeX string.</p>
<ul>
    <li><code>...ex</code>: One or more math.js expressions or strings.</li>
</ul>
<pre><code>const latexString = latexstr(deriv('x^2', 'x'), '=', '2x');
echo(latexString); // "{\frac {d}{dx}}\left({x}^{2}\right)=2x"</code></pre>

<h3><code>latex(...ex)</code></h3>
<p>Displays one or more math.js expressions (or strings) as rendered LaTeX in the output.</p>
<ul>
    <li><code>...ex</code>: One or more math.js expressions or strings.</li>
</ul>
<pre><code>// Display a simple equation
latex('E = mc^2');

// Display an integral
latex('\int_a^b x^2 dx');

// Display a derivative from math.js
latex(deriv('x^3', 'x'));</code></pre>

<h3><code>runcode(code, info)</code></h3>
<p>Runs a piece of JavaScript code asynchronously within the JSLab environment. This function handles Babel transformation and execution.</p>
<ul>
    <li><code>code</code>: The JavaScript code string to execute.</li>
    <li><code>info</code>: (Optional) An object to receive compilation information (e.g., <code>compiled_code</code>).</li>
</ul>
<p>Returns a Promise that resolves with the result of the code execution.</p>
<pre><code>// This is usually called internally by JSLab when you run a cell.
// Direct use might be for advanced scenarios or dynamic code execution.
runcode("console.log('Hello from runcode!'); return 1+1;")
    .then(result => echo('Runcode result:', result));</code></pre>

<h3><code>runcodeSync_(code, info)</code></h3>
<p>Runs a piece of JavaScript code synchronously within the JSLab environment. This function handles Babel transformation and execution.</p>
<ul>
    <li><code>code</code>: The JavaScript code string to execute.</li>
    <li><code>info</code>: (Optional) An object to receive compilation information (e.g., <code>compiled_code</code>).</li>
</ul>
<p>Returns the result of the code execution directly (not a Promise).</p>
<pre><code>// Similar to runcode, but for synchronous execution.
// Less commonly used directly by end-users.
let syncResult = runcodeSync_("return 'Synchronous result: ' + (5 * 5);");
echo(syncResult);</code></pre>
